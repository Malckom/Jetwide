<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Contact Form</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        .debug-info { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; font-family: monospace; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background: #d4af37; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; }
        button:disabled { background: #ccc; }
        .step { margin: 10px 0; padding: 10px; border-left: 4px solid #007bff; background: #f8f9fa; }
    </style>
</head>
<body>
    <h2>🔧 Debug Contact Form</h2>
    <p>This will help us identify exactly where the issue is occurring.</p>

    <div id="steps">
        <div class="step" id="step1">📋 Step 1: Fill out the form and click submit</div>
        <div class="step" id="step2">🔧 Step 2: Check if PHP endpoint is reachable</div>
        <div class="step" id="step3">📤 Step 3: Test form data submission</div>
        <div class="step" id="step4">📧 Step 4: Test email sending</div>
    </div>

    <button onclick="testEndpoint()">🔧 Test PHP Endpoint First</button>

    <form id="debugForm">
        <div class="form-group">
            <label>First Name *</label>
            <input type="text" name="firstName" value="Test" required>
        </div>
        <div class="form-group">
            <label>Last Name *</label>
            <input type="text" name="lastName" value="User" required>
        </div>
        <div class="form-group">
            <label>Email *</label>
            <input type="email" name="email" value="test@example.com" required>
        </div>
        <div class="form-group">
            <label>Destination *</label>
            <select name="destination" required>
                <option value="Maasai Mara" selected>Maasai Mara</option>
                <option value="Amboseli">Amboseli</option>
            </select>
        </div>
        <div class="form-group">
            <label>Trip Type *</label>
            <select name="tripType" required>
                <option value="Safari" selected>Safari</option>
                <option value="Adventure">Adventure</option>
            </select>
        </div>
        <div class="form-group">
            <label>Start Date *</label>
            <input type="date" name="startDate" required>
        </div>
        <div class="form-group">
            <label>Duration *</label>
            <select name="duration" required>
                <option value="3 Days" selected>3 Days</option>
                <option value="5 Days">5 Days</option>
            </select>
        </div>
        <div class="form-group">
            <label>Group Size *</label>
            <select name="groupSize" required>
                <option value="2 people" selected>2 people</option>
                <option value="4 people">4 people</option>
            </select>
        </div>
        
        <button type="submit">🚀 Submit Debug Form</button>
    </form>

    <div id="debugOutput"></div>

    <script>
        // Set today's date as default
        document.querySelector('input[name="startDate"]').value = new Date().toISOString().split('T')[0];

        function addDebugInfo(message, type = 'info') {
            const output = document.getElementById('debugOutput');
            const div = document.createElement('div');
            div.className = `debug-info ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            output.appendChild(div);
            console.log(message);
        }

        async function testEndpoint() {
            addDebugInfo('🔧 Testing if PHP endpoint is reachable...');
            
            try {
                const response = await fetch('send-contact-form.php', {
                    method: 'GET'
                });
                
                addDebugInfo(`📡 Response status: ${response.status} ${response.statusText}`);
                
                const text = await response.text();
                addDebugInfo(`📄 Response text: ${text}`);
                
                if (response.ok) {
                    const data = JSON.parse(text);
                    addDebugInfo(`✅ PHP endpoint is working! Message: ${data.message}`, 'success');
                } else {
                    addDebugInfo(`❌ HTTP error: ${response.status}`, 'error');
                }
            } catch (error) {
                addDebugInfo(`❌ Network error: ${error.message}`, 'error');
                addDebugInfo(`💡 This might mean the PHP file is not accessible or there's a server issue.`, 'error');
            }
        }

        document.getElementById('debugForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            addDebugInfo('📋 Form submitted - starting debug process...');
            
            const button = e.target.querySelector('button');
            const originalText = button.textContent;
            button.textContent = '🔄 Processing...';
            button.disabled = true;

            try {
                // Collect form data
                const formData = new FormData(this);
                const data = {
                    firstName: formData.get('firstName'),
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    phone: '',
                    country: '',
                    destination: formData.get('destination'),
                    tripType: formData.get('tripType'),
                    startDate: formData.get('startDate'),
                    duration: formData.get('duration'),
                    groupSize: formData.get('groupSize'),
                    budget: '',
                    accommodation: '',
                    services: [],
                    specialRequests: 'This is a DEBUG test submission.'
                };

                addDebugInfo(`📤 Sending data: ${JSON.stringify(data, null, 2)}`);

                // Test the fetch request
                addDebugInfo('🌐 Making fetch request to send-contact-form.php...');
                
                const response = await fetch('send-contact-form.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                addDebugInfo(`📡 Response received - Status: ${response.status} ${response.statusText}`);
                
                const responseText = await response.text();
                addDebugInfo(`📄 Raw response: ${responseText}`);
                
                try {
                    const result = JSON.parse(responseText);
                    addDebugInfo(`📋 Parsed JSON response: ${JSON.stringify(result, null, 2)}`);
                    
                    if (result.success) {
                        addDebugInfo(`✅ SUCCESS: ${result.message}`, 'success');
                        if (result.debug) {
                            addDebugInfo(`🔍 Debug info: ${JSON.stringify(result.debug)}`, 'success');
                        }
                    } else {
                        addDebugInfo(`❌ ERROR: ${result.message}`, 'error');
                        if (result.debug) {
                            addDebugInfo(`🔍 Debug info: ${result.debug}`, 'error');
                        }
                    }
                } catch (parseError) {
                    addDebugInfo(`❌ Failed to parse JSON response: ${parseError.message}`, 'error');
                    addDebugInfo(`💡 This might indicate a PHP error or non-JSON response`, 'error');
                }

            } catch (error) {
                addDebugInfo(`❌ Fetch error: ${error.message}`, 'error');
                addDebugInfo(`💡 This could be a network issue or CORS problem`, 'error');
                
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        });
    </script>
</body>
</html>